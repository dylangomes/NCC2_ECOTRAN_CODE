library(ncdf4) # package for netcdf manipulation
library(raster) # package for raster manipulation
library(rgdal) # package for geospatial analysis
library(ggplot2) # package for plotting
library(dplyr) # package for plotting
# nc_data <- nc_open('C:/Users/dgome/Documents/ECOTRAN_NCC/code_files/CUTI/CUTI_daily.nc',write=T)
nc_data <- nc_open('CUTI_daily - Copy.nc',write=T)
CUTI<-ncvar_get(nc_data,"CUTI")
dim(CUTI) # 17 latitude values by number of days in file
# mean(CUTI)
CUTI[1:4,1:3] ## just look at a sample of huge file
head(CUTI)
summary(CUTI)
12600/365
Vis<-read.csv("Upwelling_CUTI_daily.csv")
head(Vis)
Vis<-Vis %>% filter(year<2022)
Vis$yday<-as.POSIXlt(paste0(Vis$year,"-",Vis$month,"-",Vis$day),format="%Y-%m-%d")$yday
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_line()
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)
AVG<-Vis  %>% group_by(yday) %>%
summarise(meanCUTI=mean(X45N))
ggplot(Vis)+
geom_smooth(se=F,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(data=AVG,aes(x=yday,y=meanCUTI),color="red",se=F)+
theme_minimal()+
theme(axis.line=element_line(),
legend.position=c(0.7,.3))+
scale_x_continuous(expand = c(0, 0))+
labs(y="CUTI",
x="Day of year",
color="Year")
ggplot(Vis)+
geom_smooth(se=F,aes(x=yday,y=X45N,group=year,color=year))+
geom_line(data=AVG,aes(x=yday,y=meanCUTI),color="red",se=F)+
theme_minimal()+
theme(axis.line=element_line(),
legend.position=c(0.7,.3))+
scale_x_continuous(expand = c(0, 0))+
labs(y="CUTI",
x="Day of year",
color="Year")
## create file of average upwelling across years
AvgSeries<-Vis  %>% dplyr::group_by(yday) %>%
dplyr::summarise_at(vars("X31N":"X47N"),.funs=mean)
head(Vis)
head(AvgSeries)
Vismeta<-Vis %>% select(year,month,day,yday)
Avg<-left_join(Vismeta,AvgSeries,by="yday")
ggplot(Avg,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)
ggplot(Avg,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)+
geom_line(se=F)
ggplot(Avg,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)+
geom_line(se=F,color="red")
Vis<-read.csv("Upwelling_CUTI_daily.csv")
Vis<-Vis %>% filter(year<2022)
Vis$yday<-as.POSIXlt(paste0(Vis$year,"-",Vis$month,"-",Vis$day),format="%Y-%m-%d")$yday
library(plotly)
ggplotly(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_line()
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_line()
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)
p<-ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)
ggplotly(p)
Years<-c(1993,1998,2019)
Vis$year
ggplot(Vis[Vis$year%in%Years,],
aes(x=yday,y=X45N,group=as.factor(year),color=as.factor(year)))+
geom_smooth(se=F)
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)+
geom_smooth(se=F,data=Vis[Vis$year%in%Years,],
aes(x=yday,y=X45N,group=as.factor(year),color=as.factor(year)))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)+
geom_smooth(se=F,data=Vis[Vis$year%in%Years,],
aes(x=yday,y=X45N,group=(year),color=(year)))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=year))+
geom_smooth(se=F)+
geom_smooth(se=F,data=Vis[Vis$year%in%Years,],
aes(x=yday,y=X45N,group=(year),color=factor(year)))
head(Vis)
Vis$col<-ifelse(Vis$year%in%Years,Vis$year,"other")
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F,alpha=.2)
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F,alpha=.1)
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_discrete(alpha=.1)
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_discrete(values=c("grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_discrete(values=c("grey","grey","grey","grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_discrete(value=c("grey","grey","grey","grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_manual(value=c("grey","grey","grey","grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_manual(values=c("grey","grey","grey","grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_manual(values=c("red","grey","grey","grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
scale_color_manual(values=c("red","black","blue","grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
geom_smooth(se=F,data=Vis[Vis$year%in%Years,])+
scale_color_manual(values=c("red","black","blue","grey"))
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
geom_smooth(se=F,data=Vis[Vis$year%in%Years,])+
scale_color_manual(values=c("red","black","blue","grey"))+
theme_minimal()
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_line()+
geom_line(data=Vis[Vis$year%in%Years,])+
scale_color_manual(values=c("red","black","blue","grey"))+
theme_minimal()
Years<-c(1993,1998,2008,2019)
Vis$col<-ifelse(Vis$year%in%Years,Vis$year,"other")
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_line()+
geom_line(data=Vis[Vis$year%in%Years,])+
scale_color_manual(values=c("red","black","blue","orange","grey"))+
theme_minimal()
ggplot(Vis,aes(x=yday,y=X45N,group=year,color=col))+
geom_smooth(se=F)+
geom_smooth(se=F,data=Vis[Vis$year%in%Years,])+
scale_color_manual(values=c("red","black","blue","orange","grey"))+
theme_minimal()
nc_close(nc_data)
2021-1988
2022-1988
12600/365
## Choose dates for individual years
CD<-read.csv("CUTI_daily.csv")
head(CD)
length(CD$year)
year<-"2008"
class(CD$year)
Year<-2008
which(CD$year==Year)
Index<-which(CD$year==Year)
# nc_data <- nc_open('C:/Users/dgome/Documents/ECOTRAN_NCC/code_files/CUTI/CUTI_daily.nc',write=T)
nc_data <- nc_open('CUTI_daily - Copy.nc',write=T)
CUTI<-ncvar_get(nc_data,"CUTI")
dim(CUTI) # 17 latitude values by number of days in file
CUTI<-CUTI[,c(Index)]
dim(CUTI) # 17 latitude values by number of days in file
ncvar_put(nc_data,"CUTI",vals=CUTI)
